var lastDemoUpdate=0;var _orgId="CURORGID";var _userId="CURUSERID";var _passwd="CURPASSWORD";var _checknum="CHECKNUM";var checkNumType="100";var _winmod="winmod";var _submit="submit";var _confirmBtn="confirmBtn";var _curDbWhIdDetail="CURDBWHID_DETAIL";var authorWHInfo=null;var _loginElsewhere="loginElsewhere";var indiv=false;var selecteddiv="";var fuzzysearchinput="";var selectedstr="";var selectednamestr="";var curLoginSystype="wms";var msg0="";var msg1="";var msg2="";var msg3="";var msg4="";var msg5="";var msg6="";var msg7="";var loginToSystem="";var forceLogin="";var dialogConfirmText="";var dialogCancleText="";var produceWHText="";var historyWHText="";var historyWHErr="";var archieveWHText="";var archieveWHErr="";var normalWHtips="Loading......&nbsp;&nbsp;";var authorInformation="";var loginElsewhereInfo="";var clearBtn="";var returnBtn="";var info="";var loginElsewhereWin=null;var sImagePathForWindows;var dialogTitle;var dialogText;var dialogLbl01;var dialogLbl02;var modulus="";var publicExponent="";var whIndex;var autoLogin=false;var forwardToFunctionId="";var forwardToUserId="";var forwardToPwd="";var forwardToLanguage="";var forwardToOrganizationId="";var forwardToWhId="";var macAddress="";var workStation="";function initLoginHtml(refreshCheckNum){indiv=false;selecteddiv=document.getElementById("selectdiv");fuzzysearchinput=document.getElementById("fuzzysearch");selectedstr="";selectednamestr="";document.onclick=function(event){if(event.target.id=="selectButton"||event.target.id=="udfTriangle"||indiv){if(document.getElementById("selectdiv").style.display=="block"){return;}}selecteddiv.style.display="none";document.getElementById("fuzzysearchdiv").style.display="none";};$("#from_login").show();$("#forceLoginContainer").hide();var loginBtnWidth=document.getElementById("CURORGID").clientWidth;document.getElementById("submit").style.width=loginBtnWidth+30+"px";loginBoxAjust();if(typeof refreshCheckNum!="undefined"&&refreshCheckNum==true){var obj=document.getElementById("checknumImg");refresh(obj);setValue(_checknum,"");}if(forwardToUserId!=null||forwardToUserId.length>0){setValue(_userId,forwardToUserId);}else{setValue(_userId,"");}if(forwardToPwd!=null||forwardToPwd.length>0){setValue(_passwd,forwardToPwd);}else{setValue(_passwd,"");}var orgId=getValue(_orgId);if(orgId==null||orgId.length==0){setFocus(_orgId);}else{setFocus(_userId);}updateLoginResult("");if(autoLogin==true){getUserInfo();}}function sysToSysAutoLogin(t_userid,t_winmod,t_oid,t_admin,t_lang,secretCode,t_fmsystype){var t_macAddress="";var t_workStation="";var browserInfo=getBrowserInfo();var timeZone=getClientTimeZone();var sOrgId=t_oid;var sUserId=t_userid;var sCheckNum="";var sWinmod="m2";var isOnlySec="N";updateLoginResult(msg3);setMaxDigits(1024);var secretCode=encodeURIComponent(secretCode);var oid=encodeURIComponent(sOrgId);var uid=encodeURIComponent(sUserId);var fmsystype=encodeURIComponent(t_fmsystype);var wmod=encodeURIComponent(sWinmod);var isAdmin=encodeURIComponent(isOnlySec);var sLang=t_lang;sLang=encodeURIComponent(sLang);var cws=encodeURIComponent(t_workStation);var mac=encodeURIComponent(t_macAddress);browserInfo=encodeURIComponent(browserInfo);timeZone=encodeURIComponent(timeZone);var queryString="opr=8001&FMSYS=Y&id="+uid+"&loginFsysAppSecretCode="+secretCode+"&winmod="+wmod+"&s64=Y";queryString=queryString+"&oid="+oid+"&admin="+isAdmin;queryString=queryString+"&fmsystype="+fmsystype;queryString=queryString+"&lang="+sLang+"&ver=20160827";queryString=queryString+"&cws="+cws+"&mac="+mac+"&browserInfo="+browserInfo+"&timezone="+timeZone;if(typeof isForce!="undefined"&&isForce=="Y"){queryString+="&fl="+isForce;}$.ajax({type:"POST",url:webRoot+"/WmsLoginAction",data:encodeURI(queryString),async:true,dataType:"text"}).done(function(data){updateUserInfo(data);}).fail(function(XMLHttpRequest,textStatus,errorThrown){if(textStatus=="timeout"){updateLoginResult(msg5);}else{updateLoginResult(msg6);throw new Error("Error:WmsLoginAction:login");}}).always(function(){});}function initHasLoginHtml(userName){$("#forceLoginContainer").show();$("#from_login").hide();loginBoxAjust();$(".userItem_title").html(userName);}function loginBoxAjust(){var from_loginHeight=document.getElementById("from_login").clientHeight;var form_LoginWidth=document.getElementById("from_login").clientWidth;var force_loginHeight=document.getElementById("forceLoginContainer").clientHeight;var force_loginWidth=document.getElementById("forceLoginContainer").clientWidth;var bodyHeight=document.body.clientHeight;document.getElementById("loginbox").style.marginTop=(bodyHeight-from_loginHeight-force_loginHeight)/2+"px";var loginBtnWidth=document.getElementById("CURORGID").clientWidth;document.getElementById("submit").style.width=loginBtnWidth+30+"px";}function updateLoginResult(sNewStr){if(sNewStr.length>0){$("#login_validationMessage").html(sNewStr).show();}else{$("#login_validationMessage").hide();}}function txtINFO_EnterEvent(oEvent){if(oEvent.keyCode==13){getUserInfo();}}function getUserInfo(isForce){var browserInfo=getBrowserInfo();var timeZone=getClientTimeZone();var sOrgId=getValue(_orgId);if(sOrgId==null||sOrgId.length==0){updateLoginResult(msg0);setFocus(_orgId);return;}var sUserId=getValue(_userId);if(sUserId==null||sUserId.length==0){updateLoginResult(msg1);setFocus(_userId);return;}var sPasswd=getValue(_passwd);if(sPasswd==null||sPasswd.length==0){updateLoginResult(msg2);setFocus(_passwd);return;}var sCheckNum="";if(checkNumType=="200"&&(typeof isForce=="undefined"||isForce!="Y")){sCheckNum=getValue(_checknum);if(sCheckNum==null||sCheckNum.length==0){updateLoginResult(msg4);setFocus(_checknum);return;}}var sWinmod="m2";var sSID01=getValue("SID001");var isOnlySec=getValue("ISONLYSEC");updateLoginResult(msg3);setMaxDigits(1024);var key=new RSAKeyPair(publicExponent,"",modulus);var pd3=encryptedString(key,encodeURI(encodeURIComponent(sPasswd)));pd3=encodeURIComponent(pd3);var oid=encodeURIComponent(sOrgId);var uid=encodeURIComponent(sUserId);var wmod=encodeURIComponent(sWinmod);var isAdmin=encodeURIComponent(isOnlySec);var checknum=encodeURIComponent(sCheckNum);var sLang=getValue("CURLANG");sLang=encodeURIComponent(sLang);var cws=encodeURIComponent(workStation);var mac=encodeURIComponent(macAddress);browserInfo=encodeURIComponent(browserInfo);timeZone=encodeURIComponent(timeZone);var queryString="opr=8001&id="+uid+"&pd1="+modulus+"&pd2="+publicExponent+"&pd3="+pd3+"&winmod="+wmod+"&s64=Y";queryString=queryString+"&oid="+oid+"&admin="+isAdmin;queryString=queryString+"&checknumtype="+checkNumType+"&checknum="+checknum+"&SID01="+sSID01+"&lang="+sLang+"&ver=20160827";queryString=queryString+"&cws="+cws+"&mac="+mac+"&browserInfo="+browserInfo+"&timezone="+timeZone;if(typeof isForce!="undefined"&&isForce=="Y"){queryString+="&fl="+isForce;}$.ajax({type:"POST",url:webRoot+"/WmsLoginAction",data:encodeURI(queryString),async:true,dataType:"text"}).done(function(data){updateUserInfo(data);}).fail(function(XMLHttpRequest,textStatus,errorThrown){if(textStatus=="timeout"){updateLoginResult(msg5);}else{updateLoginResult(msg6);throw new Error("Error:WmsLoginAction:login");}}).always(function(){});}function updateUserInfo(resultText){var replyData=eval("("+resultText+")");var result=replyData.result;var loginElsewhere=replyData.loginElsewhere;var loginFromSys=replyData.loginFromSys;if(loginElsewhere&&loginElsewhere=="Y"){updateLoginResult(""+replyData.msg);loginElsewhereWH(replyData.sysType);}else{if(result=="OK"&&"Y"!=loginElsewhere){curLoginSystype=replyData.sysType?replyData.sysType:"wms";login(replyData,loginFromSys);}else{if(result=="D_L"){if(autoLogin==true&&forwardToFunctionId!=null&&forwardToFunctionId.length>0){getUserInfo("Y");}else{var sUserId=getValue(_userId);initHasLoginHtml(sUserId);}}else{$("#from_login").show();$("#forceLoginContainer").hide();loginBoxAjust();updateLoginResult(""+replyData.msg);setDisabled(_submit,false);setDisabled(_userId,false);setDisabled(_passwd,false);$("#submit").attr("value",loginToSystem);var obj=document.getElementById("checknumImg");refresh(obj);setValue(_checknum,"");}}}}function loginElsewhereWH(sysType){var tplHtml="<div style='height:120px;padding:20px;'>"+loginElsewhereInfo+"</div>";tplHtml=tplHtml+'<div class="LoginELsewhereWinBtnArea col-md-100" style="position:absolute;bottom:0px;padding:20px 20px 10px 20px;"><button id="clearLocalLogin" class="btn btn-info" style="padding:6px 12px;" onclick="clearLocalLoginInfo();return false;">'+clearBtn+'</button><button id="returnLogin" style="padding:6px 12px;float:right;" class="btn btn-default" onclick="canclLoginElseWH();return false;">'+returnBtn+"</button>";loginElsewhereWin=layer.open({type:1,shade:[0.5,"#EEEEEE"],title:info,content:tplHtml,area:["300px","170px"],id:"loginElsewhere_window",closeBtn:0,cancel:function(){return false;},success:function(layero,index){var obj=document.getElementById("clearLocalLogin");if(obj!=null){obj.focus();}}});clearLocalLoginInfo=function(){layer.close(loginElsewhereWin);var obj=document.getElementById("clearLocalLogin");if(obj!=null){obj.focus();}var queryString="isClearLogin=Y&sysType="+sysType;$.ajax({type:"POST",url:webRoot+"/WmsLogoutAction",data:encodeURI(queryString)}).done(function(data){initLoginHtml(true);}).fail(function(){throw new Error("Error:clearLocalLoginInfoAction:login");return false;}).always(function(){});};canclLoginElseWH=function(){layer.close(loginElsewhereWin);};}function login(replyData,loginFromSys){if(typeof(replyData)!="object"){return;}var returnUrl=replyData.url;var isAdmin=replyData.admin;var fmSystype=replyData.fmSystype;if(returnUrl==null||returnUrl.length<=0||"Y"!=isAdmin){getDbWhInfo(loginFromSys);}else{if(loginFromSys=="Y"&&fmSystype=="tms"&&returnUrl=="wmsadmin_workplace"){$("#from_login").show();$("#forceLoginContainer").hide();updateLoginResult(msg7);}else{if(replyData.warnList&&replyData.warnList.length>0){_warnListInfoWin(replyData);}else{document.location.href=returnUrl;return;}}return;}}function getClientTimeZone(){var nowTime=new Date();var timeZone=(nowTime.getTimezoneOffset()/60)+"";var reTimerZone="+08:00";if(timeZone=="0"){reTimerZone="+00:00";}var isEast=false;var splitZone="";if(timeZone.indexOf("-")==0){isEast=true;splitZone=timeZone.substring(1,timeZone.length)+"";if(splitZone=="1"){reTimerZone="+01:00";}else{if(splitZone=="2"){reTimerZone="+02:00";}else{if(splitZone=="3"){reTimerZone="+03:00";}else{if(splitZone=="4"){reTimerZone="+04:00";}else{if(splitZone=="5"){reTimerZone="+05:00";}else{if(splitZone=="6"){reTimerZone="+06:00";}else{if(splitZone=="7"){reTimerZone="+07:00";}else{if(splitZone=="8"){reTimerZone="+08:00";}else{if(splitZone=="9"){reTimerZone="+09:00";}else{if(splitZone=="10"){reTimerZone="+10:00";}else{if(splitZone=="11"){reTimerZone="+11:00";}else{if(splitZone=="12"){reTimerZone="+12:00";}else{reTimerZone="+00:00";}}}}}}}}}}}}}if(!isEast){if(timeZone.indexOf("+")==0){splitZone=timeZone.substring(1,timeZone.length)+"";}else{splitZone=timeZone;}if(splitZone=="1"){reTimerZone="-01:00";}else{if(splitZone=="2"){reTimerZone="-02:00";}else{if(splitZone=="3"){reTimerZone="-03:00";}else{if(splitZone=="4"){reTimerZone="-04:00";}else{if(splitZone=="5"){reTimerZone="-05:00";}else{if(splitZone=="6"){reTimerZone="-06:00";}else{if(splitZone=="7"){reTimerZone="-07:00";}else{if(splitZone=="8"){reTimerZone="-08:00";}else{if(splitZone=="9"){reTimerZone="-09:00";}else{if(splitZone=="10"){reTimerZone="-10:00";}else{if(splitZone=="11"){reTimerZone="-11:00";}else{if(splitZone=="12"){reTimerZone="-12:00";}else{reTimerZone="+00:00";}}}}}}}}}}}}}return reTimerZone;}function getBrowserInfo(){var ua=window.navigator.userAgent;var osName="";var browserName="";try{if(ua.indexOf("Chrome")!=-1&&ua.indexOf("Edge")<0){browserName=ua.match(/Chrome\/[\d.]+/gi)[0];osName=getOsName(ua);}else{if(ua.indexOf("MSIE 8.0")!=-1&&ua.indexOf("Trident")>-1){browserName="IE8";osName=getOsName(ua,"IE8");}else{if(ua.indexOf("MSIE 9.0")!=-1&&ua.indexOf("Trident")>-1){browserName="IE9";osName=getOsName(ua,"IE9");}else{if(ua.indexOf("MSIE 10.0")!=-1&&ua.indexOf("Trident")>-1){browserName="IE10";osName=getOsName(ua,"IE10");}else{if(ua.match(/Trident.*rv[ :]*11\./)){browserName="IE11";osName=getOsName(ua);}else{if(ua.indexOf("Firefox")!=-1){browserName=ua.match(/Firefox\/[\d.]+/gi)[0];osName=getOsName(ua);}else{if(ua.indexOf("Safari")!=-1&&ua.indexOf("Chrome")<0){browserName=ua.match(/Safari\/[\d.]+/gi)[0];if(ua.indexOf("iPhone")!=-1){osName=ua.match(/iPhone[ A-Za-z\d_]+/gi)[0];}else{if(ua.indexOf("Mac OS")!=-1){osName=ua.match(/Mac[ A-Za-z\d_]+/gi)[1];}else{osName=getOsName(ua);}}}else{if(ua.indexOf("Edge")!=-1){browserName=ua.match(/Edge\/[\d.]+/gi)[0];osName=getOsName(ua);}}}}}}}}if(osName&&browserName){return"OS："+osName+" , Browser："+browserName;}else{return ua;}}catch(err){return ua;}}function getOsName(ua,IE){var str=ua.match(/[^\(\)]+(?=\))/g)[0];var arr=str?str.split(";"):"";var osName;if(ua.indexOf("Android")!=-1||IE=="IE10"||IE=="IE9"||IE=="IE8"){osName=arr[2]?arr[2]:"";}else{osName=arr[0]?arr[0]:"";}return osName;}function openDialogBox(resultText){$("#selectdiv").find(".wh_option").remove();$("#fuzzysearch").val("");$("#msgForLoadingDbList").html("Loading......&nbsp;&nbsp;");$("#div2SelectWH").show();if(loginElsewhereWin!=null){layer.close(loginElsewhereWin);}$("#login_validationMessage").hide();loginBoxAjust();updateFormContentsForDbWh(resultText);}function confirmWH(){doConfirmWh();}function cancleWH(){$.ajax({type:"POST",url:webRoot+"/WmsLogoutAction"}).done(function(data){initLoginHtml(true);}).fail(function(){throw new Error("Error:WmsLoginAction:login");return false;}).always(function(){layer.close(whIndex);$("#div2SelectWH").hide();loginBoxAjust();});}function clearLocalLoginInfo(sysType){var queryString="isClearLogin=Y&sysType="+sysType;$.ajax({type:"POST",url:webRoot+"/WmsLogoutAction",data:encodeURI(queryString)}).done(function(data){console.log("清除成功");initLoginHtml(true);}).fail(function(){throw new Error("Error:clearLocalLoginInfoAction:login");return false;}).always(function(){});}function logout(callback){$.ajax({type:"POST",url:webRoot+"/WmsLogoutAction"}).done(function(data){$("#from_login").show();$("#forceLoginContainer").hide();loginBoxAjust();if(typeof callback!="undefined"&&callback.onDone){}}).fail(function(){throw new Error("Error:WmsLoginAction:login");return false;}).always(function(){});}function getDbWhInfo(loginFromSys){var sLang=getValue("CURLANG");sLang=encodeURIComponent(sLang);var queryString="opr=2000&returnError=N&lang="+sLang+"&sysType="+curLoginSystype+"&ver=20160827";$.ajax({type:"POST",url:webRoot+"/WmsBizDbListAction",data:encodeURI(queryString),async:true,dataType:"text"}).done(function(data){var evalData=eval("("+data+")");var defaultDbId=evalData.defaultDbId;var bizDbList=evalData.bizDbList;authorWHInfo=bizDbList;var resultText={};var len=bizDbList.length;if(loginFromSys=="Y"){var _useDbObj={};if(bizDbList!=null&&bizDbList.length>0){_useDbObj=bizDbList[0];for(var j=0;j<bizDbList.length;j++){if(bizDbList[j].dbId==defaultDbId){_useDbObj=bizDbList[j];break;}}}doConfirmWh(_useDbObj);}else{if(autoLogin==true){var _useDbObj={};if(bizDbList!=null&&bizDbList.length>0){for(var i=0;i<bizDbList.length;i++){if(bizDbList[i].dbId==forwardToWhId){_useDbObj=bizDbList[i];break;}}}doConfirmWh(_useDbObj);}else{if(len==1){var showSelect=historyAndArchieveWin(bizDbList[0].dbId,bizDbList);if(showSelect==true){openDialogBox(data);}else{warnListInfoWin(data,true);}}else{openDialogBox(data);}}}}).fail(function(){throw new Error("Error:WmsBizDbListAction:login");}).always(function(){});}function getWorkStation(){var ws;if(!window.WebSocket&&!window.MozWebSocket){console.warn("No Support WebSocket");return;}else{if(!window.WebSocket&&window.MozWebSocket){window.WebSocket=window.MozWebSocket;}else{if(!window.WebSocket){console.warn("No Support WebSocket");return;}}}try{var curWwwPath=window.document.location.href;var wsType;var wsIpAddr;var SOCKECT_ADDR;if(curWwwPath.indexOf("https")==0){window.useSSL="Y";}if(window.useSSL=="Y"){wsType="wss";wsIpAddr="localhost";wsPort="65364";}else{wsType="ws";wsIpAddr="127.0.0.1";wsPort="65365";}var SOCKECT_ADDR=wsType+"://"+wsIpAddr+":"+wsPort+"/";ws=new WebSocket(SOCKECT_ADDR);ws.onopen=function(event){SendData('getFileText {"tid":"20180615131710_11","act":"","browseUrl":"","fileName":"C:\\\\Users\\\\Public\\\\fluxWmsCfg.txt","callback":{}}\r\n');SendData('getSystemInfo {"tid":"20180615131710_12","infoType":"NetworkAdapter.1.PhysicalAddress","callback":{}}\r\n');};ws.onmessage=function(event){var tmpResult=event.data;try{var tmpTaskId=null;var tmpResultObj=null;if(tmpResult!=null&&tmpResult.length>0){var iPos=tmpResult.indexOf("=");if(tmpResult.indexOf("{")!=0&&iPos>=0&&iPos<30){tmpTaskId=tmpResult.slice(0,iPos);tmpResult=tmpResult.slice(iPos+1);if(tmpTaskId.indexOf("ErrorFLUXAPP")>-1){return;}if(tmpTaskId=="20180615131710_11"){tmpResult=JSON.parse(tmpResult);workStation=tmpResult["WorkStation.workStation"];if(typeof(t_workStation)!="undefined"&&t_workStation=="a"){t_workStation=tmpResult["WorkStation.workStation"];}}else{if(tmpTaskId=="20180615131710_12"){macAddress=tmpResult;if(typeof(t_macAddress)!="undefined"&&t_macAddress=="a"){t_macAddress=tmpResult;}}}return;}if(tmpResult.indexOf("{")!=-1){tmpResultObj=JSON.parse(tmpResult);if(tmpResultObj.hasOwnProperty("Tid")){tmpTaskId=tmpResultObj.Tid;if(tmpTaskId=="20180615131710_11"){if(tmpResultObj.hasOwnProperty("CallbackParam")&&typeof(tmpResultObj.CallbackParam)=="object"&&tmpResultObj.CallbackParam.length>1){if(tmpResultObj.CallbackParam[1]!=""){var obj=JSON.parse(tmpResultObj.CallbackParam[1]);workStation=obj["WorkStation.workStation"];if(typeof(t_workStation)!="undefined"&&t_workStation=="a"){t_workStation=obj["WorkStation.workStation"];}}}}else{if(tmpTaskId=="20180615131710_12"){if(tmpResultObj.hasOwnProperty("CallbackParam")&&typeof(tmpResultObj.CallbackParam)=="object"&&tmpResultObj.CallbackParam.length>1){var obj=JSON.parse(tmpResultObj.CallbackParam[1]);macAddress=obj.macAddress;if(typeof(t_macAddress)!="undefined"&&t_macAddress=="a"){t_macAddress=obj.macAddress;}}}}}}}}catch(err){console.log(err);}};ws.onclose=function(event){};ws.onerror=function(event){};}catch(ex){}function SendData(msg){try{var test=ws.send(msg);}catch(ex){console.log(ex.message);}}}var updateFormContentsForDbWh=function(resultText){$("#selectdiv").find(".wh_option").remove();$("#fuzzysearch").val("");var replyData=eval("("+resultText+")");normalWHtips=replyData.msg;var result=replyData.result;var defaultDbId=replyData.defaultDbId;var defaultDbName="";var isValidDb=false;var bizDbList=replyData.bizDbList;if(result!="OK"){$("#msgForLoadingDbList").html(replyData.msg+"&nbsp;&nbsp;");}else{var sQueryData=replyData.bizDbList;if(sQueryData!=null&&sQueryData.length>0){for(var i=0;i<sQueryData.length;i++){if(sQueryData[i].dbId==defaultDbId){defaultDbName=sQueryData[i].dbName;isValidDb=true;}var optiondiv=document.createElement("div");optiondiv.setAttribute("name","myOption");optiondiv.setAttribute("onclick","mycheck(this)");optiondiv.setAttribute("value",sQueryData[i].dbId);optiondiv.className="wh_option";var tmptext=document.createTextNode(sQueryData[i].dbName);optiondiv.appendChild(tmptext);selecteddiv.appendChild(optiondiv);}}myclick=function(){if(document.getElementById("selectdiv").style.display=="none"){if(sQueryData.length<11){document.getElementById("placeOption").style.display="none";selecteddiv.style.display="block";}else{document.getElementById("fuzzysearchdiv").style.display="block";selecteddiv.style.display="block";}}else{document.getElementById("fuzzysearchdiv").style.display="none";selecteddiv.style.display="none";}};mousein=function(){indiv=true;};mouseout=function(){indiv=false;};mycheck=function(obj){selectedstr=obj.getAttribute("value");selectednamestr=obj.innerText;document.getElementById("selectButton").value=selectednamestr;selecteddiv.style.display="none";document.getElementById("fuzzysearchdiv").style.display="none";historyAndArchieveWin(selectedstr,bizDbList);$("#msgForLoadingDbList").html(normalWHtips+"&nbsp;&nbsp;");$("#msgForLoadingDbList").css({color:"#333"});setDisabled(_confirmBtn,false);$("#fuzzysearch").val("");myfuzzysearch();};myfuzzysearch=function(){var checkboxlist=document.getElementsByName("myOption");for(var i=0;i<checkboxlist.length;i++){if(checkboxlist[i].innerText.toUpperCase().indexOf(fuzzysearchinput.value.toUpperCase())==-1){checkboxlist[i].style.display="none";}else{checkboxlist[i].style.display="block";}}};if(isValidDb){selectedstr=defaultDbId;selectednamestr=defaultDbName;document.getElementById("selectButton").value=selectednamestr;}else{selectedstr=sQueryData[0].dbId;selectednamestr=sQueryData[0].dbName;document.getElementById("selectButton").value=selectednamestr;}historyAndArchieveWin(selectedstr,bizDbList);selArcOrHisWH=function(){$("#msgForLoadingDbList").html(normalWHtips+"&nbsp;&nbsp;");$("#msgForLoadingDbList").css({color:"#333"});};$("#msgForLoadingDbList").html(replyData.msg+"&nbsp;&nbsp;");var infoList=replyData.infoList;if(infoList!=null&&infoList.length>0){$("#infoListBtn").css({display:"inline-block"});var infoListHtml="<ul>";for(var i=0;i<infoList.length;i++){infoListHtml=infoListHtml+"<li>"+infoList[i]+"</li>";}infoListHtml=infoListHtml+"</ul>";$("#infoListDetail")["0"].innerHTML="";$("#infoListDetail").append(infoListHtml);$("#infoListDetail").css({display:"none"});var isShowInfoList=true;showInfoList=function(){if(isShowInfoList){$("#infoListDetail").css({display:"block"});$("#infoListBtn").find(".downfullIcon").css({display:"none"});$("#infoListBtn").find(".upfullIcon").css({display:"inline-block"});}else{$("#infoListDetail").css({display:"none"});$("#infoListBtn").find(".downfullIcon").css({display:"inline-block"});$("#infoListBtn").find(".upfullIcon").css({display:"none"});}isShowInfoList=!isShowInfoList;};}warnListInfoWin(resultText);}};function historyAndArchieveWin(dbId,bizDbList){removeAllOptions(_curDbWhIdDetail);var produceWHName="";var showSelect=false;for(var i=0;i<bizDbList.length;i++){if(dbId==bizDbList[i].dbId){var loginWHId=dbId;if(bizDbList[i].historyDbFlag=="Y"){changeAutoSelect("wh_select","wh_select_archieve");$("#"+_curDbWhIdDetail).css({display:"inline-block"});var produceWHId="S01";var historyWHId="S02";var historyWHName=bizDbList[i].dbName+"("+historyWHText+")";produceWHName=bizDbList[i].dbName+"("+produceWHText+")";addOptionToSelect(_curDbWhIdDetail,loginWHId,produceWHName,produceWHId);addOptionToSelect(_curDbWhIdDetail,loginWHId,historyWHName,historyWHId);showSelect=true;}if(bizDbList[i].archiveDbFlag=="Y"){changeAutoSelect("wh_select","wh_select_archieve");$("#"+_curDbWhIdDetail).css({display:"inline-block"});var archiveWHId="S03";if(produceWHName==""){var produceWHId="S01";produceWHName=bizDbList[i].dbName+"("+produceWHText+")";addOptionToSelect(_curDbWhIdDetail,loginWHId,produceWHName,produceWHId);}var archiveWHName=bizDbList[i].dbName+"("+archieveWHText;if(bizDbList[i].archiveByYearFlag=="Y"&&bizDbList[i].archiveYears!=null&&bizDbList[i].archiveYears.length>0){var yearArrs=bizDbList[i].archiveYears.split(",");for(var j=0;j<yearArrs.length;j++){var archiveWHYearId=archiveWHId+"-"+yearArrs[j];var archiveWHYearName=archiveWHName+"["+yearArrs[j]+"])";addOptionToSelect(_curDbWhIdDetail,loginWHId,archiveWHYearName,archiveWHYearId);}}else{archiveWHName=archiveWHName+")";addOptionToSelect(_curDbWhIdDetail,loginWHId,archiveWHName,archiveWHId);}showSelect=true;}else{if(bizDbList[i].historyDbFlag!="Y"&&bizDbList[i].archiveDbFlag!="Y"){changeAutoSelect("wh_select_archieve","wh_select");$("#"+_curDbWhIdDetail).css({display:"none"});showSelect=false;}}break;}}return showSelect;}function changeAutoSelect(oldClassName,newClassName){$("#selectButton").removeClass(oldClassName).addClass(newClassName);$("#fuzzysearchdiv").removeClass(oldClassName).addClass(newClassName);$("#selectdiv").removeClass(oldClassName).addClass(newClassName);}function warnListInfoWin(data,onlyOneWarehouse){var replyData=eval("("+data+")");var warnList=replyData.warnList;if(warnList!=null&&warnList.length>0){_warnListInfoWin(replyData,onlyOneWarehouse);}else{var obj=document.getElementById(_confirmBtn);if(obj!=null){obj.focus();}if(replyData.bizDbList.length==1){var bizDbList=replyData.bizDbList;var showSelect=historyAndArchieveWin(bizDbList[0].dbId,bizDbList);if(showSelect!=true){doConfirmWh(bizDbList[0]);}}}}function _warnListInfoWin(replyData,onlyOneWarehouse){var warnList=replyData.warnList;var warnListHtml="<ul>";for(var i=0;i<warnList.length;i++){warnListHtml=warnListHtml+"<li>"+warnList[i]+"</li>";}if(replyData.sysType&&replyData.sysType.toUpperCase()!="WMS"&&replyData.infoList&&replyData.infoList.length>0){warnListHtml=warnListHtml+'<a id="infoListBtnArea" href="javascript:void(0);" onclick="showInfoList()">'+authorInformation;warnListHtml=warnListHtml+'<span class="downfullIcon"></span>';warnListHtml=warnListHtml+'<span class="upfullIcon" style="display:none;"></span>';warnListHtml=warnListHtml+"</a>";warnListHtml=warnListHtml+'<div id="infoListArea" style="display:none;padding-top:5px;">';var infoListHtml="<ul class='infoul' style='padding-left:10px;'>";for(var i=0;i<replyData.infoList.length;i++){infoListHtml=infoListHtml+"<li style='padding:0px !important;'>"+replyData.infoList[i]+"</li>";}infoListHtml=infoListHtml+"</ul>";warnListHtml=warnListHtml+infoListHtml;warnListHtml=warnListHtml+"</div>";showInfoList=function(){if($("#infoListArea").css("display")=="none"){$("#infoListArea")[0].style.display="block";$("#infoListBtnArea").find(".downfullIcon")[0].style.display="none";$("#infoListBtnArea").find(".upfullIcon")[0].style.display="inline-block";}else{$("#infoListArea")[0].style.display="none";$("#infoListBtnArea").find(".downfullIcon")[0].style.display="inline-block";$("#infoListBtnArea").find(".upfullIcon")[0].style.display="none";}};}warnListHtml=warnListHtml+"</ul>";warnListHtml=warnListHtml+'<div class="warnWinBtnArea col-md-100"><button id="warnWinBtn" class="btn btn-info" onclick="confirmWarnWin();return false;">'+dialogConfirmText+"</button>";var warnWin=layer.open({type:1,shade:[0.5,"#EEEEEE"],title:warn,content:warnListHtml,area:["340px","270px"],id:"warnList_window",closeBtn:0,cancel:function(){return false;},success:function(layero,index){var obj=document.getElementById("warnWinBtn");if(obj!=null){obj.focus();}}});confirmWarnWin=function(){layer.close(warnWin);var obj=document.getElementById(_confirmBtn);if(obj!=null){obj.focus();}if(replyData.bizDbList&&replyData.bizDbList.length==1){var bizDbList=replyData.bizDbList;doConfirmWh(bizDbList[0]);}else{if(replyData.sysType&&replyData.sysType.toUpperCase()!="WMS"){document.location.href=replyData.url;}}};}function doConfirmWh(resultText){var whPostfixId="";if(getValue(_curDbWhIdDetail)){var keyId=getValue(_curDbWhIdDetail);var options=$("#"+_curDbWhIdDetail+" option:selected");whPostfixId=options[0].id;}if(whPostfixId=="S02"||whPostfixId=="S03"){setDisabled(_confirmBtn,true);setDisabled(_curDbWhIdDetail,true);setDisabled("selectButton",true);setDisabled("udfTriangle",true);$("#msgForLoadingDbList").html("Loading......&nbsp;&nbsp;");var sentData="";sentData+="whPostfixId="+encodeURIComponent(whPostfixId);sentData+="&sysType="+curLoginSystype;var comUrl=common01webUrl+"WmsLoginCheckDbAction";$.ajax({type:"POST",url:comUrl,data:sentData,async:true,dataType:"text"}).done(function(data){var replyData=eval("("+data+")");var result=replyData.result;if(result!=null&&result=="OK"){$("#msgForLoadingDbList").html(normalWHtips+"&nbsp;&nbsp;");$("#msgForLoadingDbList").css({color:"#333"});_doConfirmWh(resultText);}else{if(whPostfixId=="S02"){$("#msgForLoadingDbList").html(historyWHErr+"&nbsp;&nbsp;");}else{$("#msgForLoadingDbList").html(archieveWHErr+"&nbsp;&nbsp;");}$("#msgForLoadingDbList").css({color:"red"});}}).fail(function(){if(whPostfixId=="S02"){$("#msgForLoadingDbList").html(historyWHErr+"&nbsp;&nbsp;");}else{$("#msgForLoadingDbList").html(archieveWHErr+"&nbsp;&nbsp;");}$("#msgForLoadingDbList").css({color:"red"});}).always(function(){setDisabled(_confirmBtn,false);setDisabled(_curDbWhIdDetail,false);setDisabled("selectButton",false);setDisabled("udfTriangle",false);});}else{_doConfirmWh(resultText);}}function _doConfirmWh(resultText){var historyDbFlag="N";var archiveDbFlag="N";var archiveByYearFlag="N";var archiveYears="";var whPostfixId="";if(resultText){var keyId=resultText.dbId;}else{if(getValue(_curDbWhIdDetail)){var keyId=getValue(_curDbWhIdDetail);var options=$("#"+_curDbWhIdDetail+" option:selected");whPostfixId=options[0].id;}else{var keyId=selectedstr;}}if(keyId==null||keyId==""){alert(dialogText);return;}var whid=encodeURIComponent(keyId);var sLang=getValue("CURLANG");whPostfixId=encodeURIComponent(whPostfixId);sLang=encodeURIComponent(sLang);if(resultText){var whnm=resultText.dbName;}else{if(getOptionText(_curDbWhIdDetail)){var whnm=getOptionText(_curDbWhIdDetail);}else{var whnm=selectednamestr;}}whnm=encodeURIComponent(whnm);var queryString="opr=8002&isLogin=Y&whid="+whid+"&whnm="+whnm+"&lang="+sLang+"&sysType="+curLoginSystype+"&ver=20170427";queryString+="&whPostfixId="+whPostfixId;$.ajax({type:"POST",url:webRoot+"/WmsLoginAction",data:encodeURI(queryString),async:true,dataType:"text"}).done(function(data){updateWHInfo(data);}).fail(function(){throw new Error("Error:WmsLoginAction:login");}).always(function(){});}var updateWHInfo=function(resultText){var replyData=eval("("+resultText+")");var result=replyData.result;if(result!="OK"){$("#msgForLoadingDbList").html(replyData.msg+"&nbsp;&nbsp;");}else{if(autoLogin==true&&forwardToFunctionId!=null&&forwardToFunctionId.length>0){document.location.href="wmsmodule_workplace?&fdTo=wms&mc="+forwardToFunctionId;}else{document.location.href=replyData.url;}}};var webRoot="";function setWebRoot(sWebRoot){webRoot=sWebRoot;}var common01webUrl="";function setCommon01webUrl(sCommon01webUrl){common01webUrl=sCommon01webUrl;}function getValue(inID){var obj=document.getElementById(inID);if(obj==null){return"";}if(obj.type=="checkbox"){if(obj.checked==true){return"Y";}else{return"N";}}return obj.value;}function setValue(inID,inValue){var obj=document.getElementById(inID);if(obj==null){return;}if(obj.type=="checkbox"){if(inValue=="Y"){obj.checked=true;}else{obj.checked=false;}return;}obj.value=inValue;}function setFocus(inID){var obj=document.getElementById(inID);if(obj==null){return;}obj.focus();obj.select();}function setDisabled(inID,inDisabled){var obj=document.getElementById(inID);if(obj==null){return;}obj.disabled=inDisabled;}function getDisabled(inID){return document.getElementById(inID).disabled;}function getElement(inID){return document.getElementById(inID);}function removeAllOptions(objId){var obj=document.getElementById(objId);if(obj==null){return;}obj.options.length=0;}function changeOptions(objId,options,selectValue){removeAllOptions(objId);addOptions(objId,options);if(selectValue!=null&&selectValue.length>0){var _select=document.getElementById(objId);if(_select!=null&&_select.options!=null&&_select.options.length>0){for(var i=0;i<_select.options.length;i++){if(_select.options[i]!=null&&_select.options[i].value==selectValue){_select.options[i].selected=true;break;}}}}}function getOptionText(objId){var obj=document.getElementById(objId);if(obj==null){return"";}var index=obj.selectedIndex;if(index=="-1"){return null;}else{return obj.options[index].text;}}function addOptionToSelect(objId,optValue,optText,optionId){var obj=document.getElementById(objId);if(obj==null){return;}if(optValue==null||optValue==""){return;}if(optText==null||optText==""){optText=optValue;}if(optionId==undefined||optionId==null||optionId==""){optionId=optValue;}$("#"+objId).append("<option value='"+optValue+"' id='"+optionId+"'>"+optText+"</option>");}